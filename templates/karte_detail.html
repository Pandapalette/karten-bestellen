<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Karte {{ order.nummer }} ‚Äì Chat</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#eef3ff; padding:20px; }
    .chat-container { max-width: 800px; margin: auto; background: #fff; border-radius:15px; padding:20px; box-shadow: 0 0 10px rgba(0,0,0,0.2);}
    .message { padding:10px; margin-bottom:10px; border-radius:10px; }
    .message.user { background:#d1e7dd; text-align:right; }
    .message.admin { background:#f8d7da; text-align:left; }
    .message small { display:block; color:#555; font-size:0.8rem; }
    .order-info { margin-bottom:20px; }
  </style>
</head>
<body>
<div class="chat-container">

  <h3 class="text-center">Karte {{ order.nummer }} ‚Äì {{ ingame_name }}</h3>

  <div class="order-info">
    <p><b>Gr√∂√üe:</b> {{ order.breite }}x{{ order.hoehe }}</p>
    <p><b>Preis:</b> {{ order.preis }} Coins</p>
    {% if order.bild %}
      <img src="{{ url_for('uploaded_file', filename=order.bild) }}" alt="Bild" style="max-width:200px; border-radius:10px;">
    {% endif %}
  </div>

  <h5>Chatverlauf:</h5>
  <div id="chat-box" style="max-height:400px; overflow-y:auto; margin-bottom:20px;">
    {% for msg in messages %}
      <div class="message {% if msg.user == 'Pandapalette' %}admin{% else %}user{% endif %}">
        {{ msg.text }}
        <small>{{ msg.user }} ‚Äì {{ msg.time.split('T')[0] }} {{ msg.time.split('T')[1][:8] }}</small>
      </div>
    {% endfor %}
  </div>

  <form method="post">
    <div class="mb-3">
      <textarea name="text" class="form-control" rows="3" placeholder="Nachricht schreiben..." required></textarea>
    </div>
    <button type="submit" class="btn btn-primary w-100">Senden üí¨</button>
  </form>

  <a href="{{ url_for('home') }}" class="btn btn-secondary w-100 mt-3">‚¨ÖÔ∏è Zur√ºck</a>
</div>

<script>
  // Scroll automatisch zum Ende
  var chatBox = document.getElementById('chat-box');
  chatBox.scrollTop = chatBox.scrollHeight;
</script>
</body>
</html>
